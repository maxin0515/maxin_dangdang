<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
{% load static %}
{% load test_tags %}
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>购物车Writed By MaXin</title>
<script src="/static/js/jquery_1.8.js"></script>
    <script src="/static/js/jquery_cookie.js"></script>
	<link rel="shortcut icon" href="images/favicon.ico?v=20160901" type="image/x-icon">
    <link href="/static/css/shopping_cart_new.css" rel="stylesheet" type="text/css">
	<link href="/static/css/footer_150526.css" rel="stylesheet" type="text/css" />
</head>

<body style="padding-bottom:82px">

<link href="/static/css/header_960_150611.css" rel="stylesheet" type="text/css">
<script src="/static/js/pagetop2015_0827.js" charset="gb2312" type="text/javascript"></script>

<div id="hd">
<div id="tools">
<div class="tools">
    <div class="ddnewhead_operate" dd_name="顶链接">
        
        <div class="ddnewhead_welcome" display="none;">
            {% if user_name  %}
                <span class="hi hi_none">您好，</span>
                <a href="javascript:void(0);" class="login_link">{{ user_name }}</a>
                [
                <a class="hi hi_none" href="{% url 'customer:log_out' %}?user_name={{ user_name }}" style="padding: 0px;margin: 0px" >退出登录</a>
                ]
            {% else %}
                <span class="hi hi_none">欢迎光临当当，请</span>
                <a href="{% url 'customer:login' %}?shopping_cart=1" class="login_link">登录</a>
                <a href="{% url 'customer:register' %}">免费注册</a></span>
            {% endif %}
            <div class="tel_pop" style="display:none" id="__ddnav_sjdd" onmouseover="showgaoji('a_phonechannel','__ddnav_sjdd');" onmouseout="hideotherchannel('a_phonechannel','__ddnav_sjdd');">
                <a target="_blank" href="http://t.dangdang.com/20130220_ydmr" class="title"><i class="icon_tel"></i>手机当当</a><i class="title_shadow"></i>
                <ul class="tel_pop_box">
                    <li><a href="http://t.dangdang.com/20130220_ydmr" dd_name="手机二维码"><span>当当手机客户端</span><img src="http://img3.ddimg.cn/00363/doc/erweima2.png"><span class="text">随手查订单<br>随时享优惠</span></a></li>
                </ul>
            </div>
        </div>
        <div class="new_head_znx" id="znx_content" style="display:none;"></div>
    </div>
</div>
</div>
<div id="header_end"></div>
<!--CreateDate  2016-09-28 11:30:01--></div>
<form action="http://search.dangdang.com/search.aspx" id="bootpagetopSearch" name="bootpagetopSearch" method="GET"></form>
<script type="text/javascript">var nick_num = 0;initHeaderOperate();</script><script type="text/javascript" src="http://orderb.dangdang.com/queryunpaid?callback=Unpaid_Data"></script>
		<div class="shoppingcart_wrapper" id="ad_cpt_11850"><div><a href="http://a.dangdang.com/tjump.php?q=ddo84XQOf357bOs8tXGg5%2F%2F0oVoDImt3DFWsMqu7ZMSVsfUMeOQJueASNiMLjq%2FdrXMLCKnVfyKEahteAh1ih%2ByKYrKGzhvL20LVbDzObRambBA0YPpivy5hR5foQ4Rt%2BTB" target="_blank" rel="nofollow"><img src="http://img62.ddimg.cn/2017/1/11/2017011111344969879.jpg"></a></div></div>


<div id="shopping_cart_div" style="display: block">

<div class="logo_line">
    <div class="w960">
        <div class="shopping_procedure"><span class="current">我的购物车</span><span>填写订单</span><span>完成订单</span></div>
        <div class="logo"><a href="#"><img src="/static/images/bz_logo_car.jpg" alt=""></a></div>
    </div>
</div>
<div class="w960" id="showTip">


	<!-- 结算时 商品SPU限购提示窗口 start-->
	<div id="spuPromoLimitDiv" class="pop" style="left:50%; top:50%; margin:-200px 0 0 -253px; position: fixed; z-index: 1004; display: none;">
		<a class="close"></a>
		<div class="pop_title">商品限购</div>
		<div class="popup_limit"></div>
		<div class="btn_bar limit_bar">
			<a class="btn_red">确定</a><a class="pop_btn">取消</a>
		</div>
	</div>
	<!-- 结算时 商品SPU限购提示窗口 end-->
	

	<div id="giftDiv" class="pop_tip gift_select" style="left:50%; top:50%; margin:-200px 0 0 -302px; position: fixed; z-index: 1001; display: none;">
		<div class="head_title">
			<div class="title_name">您购物车中以下商品可选为赠品</div>
			<div class="close"></div>
		</div>
		<div class="products_sort" id="giftArea">
			
		</div>
		<a href="javascript:void(0)" class="btn_b fn-back-cart">返回购物车选赠品</a><a id="gift_checkout" href="#" class="btn_b">继续结算，土豪任性不要了</a>
	</div>
	<div class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
	<div id="remove_pop" class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
	<div id="clear_pop" class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
</div>
<div class="w960" id="cart">
    <ul class="shopping_title" id="j_carttitle">
        <li class="f1"><a id="j_selectall" href="javascript:void(0)" class="checknow fn-checkall check_on" dd_name="全选">选中</a>全选</li>
        <li class="f2">商品信息</li>
        <li class="f3">单价（元）</li>
        <li class="f4">数量</li>
        <li class="f4">金额（元）</li>
        <li class="f5">操作</li>
    </ul>
    <div class="fn-shops" id="J_cartContent"><div class="fn-shop">
        <table border="0" cellspacing="0" cellpadding="0" class="shop_title">
            <tbody>
            <tr>
                <td>
                    <a href="javascript:void(0)" dd_name="选中店铺" class="checknow fn-shop-checkall check_on" id="check_shop">选中</a>
                </td>
                <td>
                    <span class="shop_icon"></span>
                </td>
                <td>
                    <a style="cursor:pointer;">当当自营</a>
                </td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
        <div class="shopping_list">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                {% for ele_book in my_shopping_cart_book_list %}
                <tbody id="{{ ele_book.book.book_id }}">
                    <tr id="tr_424893864" class="  ">
                        <td class="row1">
                            <a href="javascript:void(0)" data-item="424893864" class="fn-product-check checknow check_on" onclick="check_on_off(this)" name="check_on_tap_a">选中</a>
                            <span style="display: none" class="book_old_price">{{ ele_book.book.book_price }}</span>
                        </td>
                        <td class="row_img">
                            <a href="http://product.dangdang.com/24147882.html" target="_blank" dd_name="查看详情">
                                <img src="{% static ele_book.book.book_pic %}" width="80" height="80">
                            </a>
                            <div style="display: none;" class="img_big">
                                <a href="http://product.dangdang.com/24147882.html" dd_name="查看详情" target="_blank">
                                    <img src="http://img3x2.ddimg.cn/0/17/24147882-1_b.jpg">
                                </a>
                                <span class="arrow"></span>
                            </div>
                        </td>
                        <td class="row_name">
                            <div class="name">
                                <a href="http://product.dangdang.com/24147882.html" title="{{ ele_book.book.book_name }}" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">{{ ele_book.book.book_name }}</a>
                            </div>
                        </td>
                        <td class="row3"><span id="{{ ele_book.book.book_dprice }}">¥{{ ele_book.book.book_dprice }}</span></td>
                        <td data-minbuy="0" class="fn-count-tip row3 "><span class="amount fn-updatecount " data-value="1">
                            <a dd_name="减少数量" href="javascript:void(0)" onclick="reduce_amount(this)">-</a>
                            <input data-value="1" value="{{ ele_book.amount }}" type="text" onblur="amount_input_blur(this)" onkeyup="check_on_off_key_up(this)">
                            <a dd_name="增加数量" href="javascript:void(0)" onclick="add_amount(this)">+</a></span></td>
                        <td class="row4"><span class="red">¥{{ ele_book.book.book_dprice|money:ele_book.amount }}</span></td>
                        <td class="row5 ">
                            <span>
                                <a href="javascript:void(0)" data-item="424893864" class="fn-add-wish" dd_name="加入收藏按钮">移入收藏</a>
                            </span>
                            <span>
                                <a href="javascript:void(0)" data-item="424893864" class="fn-remove-product" dd_name="删除普通品" onclick="del_book(this)">删除</a>
                            </span>
                        </td>
                    </tr>

                </tbody>
                {% endfor %}
                <tfoot>
                <tr class="total">
                    <td class="row1">&nbsp;</td>
                    <td class="row_img">店铺合计</td>
                    <td colspan="2">&nbsp;</td>
                    <td colspan="3" class="row4">
                        <span class="red big ooline alignright" id="total_price">¥{{ my_shopping_cart_total }}</span>
                        <img id="load_gif" src="{% static 'ajax/load.gif' %}" style="height: 21px;position: absolute;top: 17px;left: 194px;display: none" >
                    </td>
                </tr>
                </tfoot>

            </table></div><div class="shipping_add" style="display:none;"></div></div></div>

    <div class="shoppingcart_loading" id="J_cartLoading" style="display: none;"><img height="30" width="30" src="/static/images/loading.gif"></div>
</div>
<div class="w960" id="weipinboxarea" style="display: none"><div class="login_tip"><span class="icon"></span>购物车中有<a id="weipinhui" href="http://v.dangdang.com" class="icon_eve weipin" style="display: none;">尾品汇</a><a id="zuizhidang" href="http://z.dangdang.com" class="icon_eve zhidang" style="display: none;">z值当</a>商品，请在<span class="time" id="J_limitedMinute"></span><span class="time" id="J_limitedSecond"></span>内结算.<a herf="javascript:;" class="more fn-vnewz-tips">了解限时结算&gt;&gt;</a></div></div>
<div id="hide_div" style="height:0px;visibility:hidden;"></div>
<div style="position:static;bottom:-20px;z-index: 101;width:100%;left:0px;">
  <div class="shopping_total" id="J_totalMoneyBlock">
    <div class="shopping_total_right">
        <a class="total_btn fn-checkout" href="javascript:void 0" id="checkout_btn" dd_name="结算">结&nbsp;&nbsp;算</a>
        <img src="{% static 'ajax/load.gif' %}" id="confirm_login_state" style="height: 35px;position: absolute;top: 5px;left: 535px;display: none">
        <div class="subtotal">
            <p><span class="cartsum">总计(不含运费)：</span><span id="payAmount" class="price">¥{{ request.session.my_shopping_cart.total }}</span></p>

            <p><span class="cartsum">已节省：</span><span id="totalFavor">¥{{ request.session.my_shopping_cart.save }}</span></p>
        </div>
        <div class="pop_del pop_ebook fn-ck" id="ck_tip" style="display:none">
			<h1>电子书重复购买提示</h1>
			<p></p>
			<a id="ck_link" href="#" class="pop_btn">朕知道了</a>
		</div>
    </div>
    <div class="shopping_total_left" id="J_leftBar">
        <a id="j_selectall2" href="javascript:void(0)" class="checknow fn-checkall" dd_name="全选">选中</a>全选
        <a id="j_removeproducts" href="javascript:void(0)" class="fn-batch-remove" dd_name="批量删除按钮">批量删除</a>
        <span>已选择<font color="red" id="books_amount">{{ book_list_length }}</font>件商品</span>
        <div id="J_batchRemoveProductBox" style="display: none;z-index:-1;left:0px;" class="pop_del"><p>您确定要批量删除商品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-batchremovebox">确定</a><a href="javascript:;" class="pop_btn fn-close-batchremovebox">取消</a></div>
        <div id="J_batchAddWishBox" style="display: none;z-index:-1;left:85px;" class="pop_del col "><p>您确定要批量移入收藏吗？</p><a href="javascript:;" class="pop_btn fn-confirm-batchaddwish">确定</a><a href="javascript:;" class="pop_btn fn-close-batchwishbox">取消</a></div>
    </div>
  </div>
</div>
<div id="J_errorBox" style="display: none;z-index:102" class="pop_del col">
    <p></p>
    <a class="pop_btn fn-close-removebox" href="javascript:;">确定</a>
</div>
<div id="J_addToWishTipHtml" style="display: none; position: absolute;"></div>
<div id="J_addWishBox" style="display: none" class="pop_del col "><p>移入收藏后，将不在购物车显示，是否继续操作？</p><a href="javascript:;" class="pop_btn fn-confirm-addwish">确定</a><a href="javascript:;" class="pop_btn fn-close-wishbox">取消</a></div>
<div id="J_removeProductBox" style="display: none;" class="pop_del"><p>您确定要删除商品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-removebox">确定</a><a href="javascript:;" class="pop_btn fn-close-removebox">取消</a></div>
<div id="J_removeGiftBox" style="display: none;" class="pop_del"><p>您确定要删除赠品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-removegiftbox">确定</a><a href="javascript:;" class="pop_btn fn-close-removebox">取消</a></div>
<div class="w960">
    <div class="empty" id="empty" style="display:none">
        <p>您的购物车还是空的，您可以：</p>
        <a href="http://www.dangdang.com" class="btn">去逛逛</a>
    </div>
    
</div>

<div class="pop_del pop_ebook" style="left:460px; right:auto; top:-130px;display: none;" id="J_vnewzTipBox">
	<a href="#" class="close"></a>
	<h1>限时说明</h1>
	<p>由于尾品会和新品汇的商品库存有限，我们只能为您保留<span class="red">20分钟</span>，否则尾品会及新品汇的商品将被删除，请尽快结算。</p>
</div>

</div>


<div id="indent_div" style="display: none">
    <div class="logo_line">
    <div class="w960">
        <div class="shopping_procedure01 shopping_procedure "><span>我的购物车</span><span class="current">填写订单</span><span>完成订单</span></div>
        <div class="logo"><a href="#"><img src="/static/images/bz_logo_car.jpg" alt=""></a></div>
    </div>
</div>
    <div class="add_line" id="district">
    <div class="w960">
        <div class="address" id="dp_adress">
            <span class="icon_adr">&nbsp;</span>配送地址：
            <select name="user_address" id="user_address">
                <option>新增地址</option>
            </select>
        </div>
    </div>
</div>
<div class="indent_con">
	<div class="shdz">
    	<h3>收货相关信息</h3>
        <ul class="shdz_con">
            <p>▪ 收货地址</p>
        	<li><label><strong>*</strong>收&nbsp;&nbsp;货&nbsp;&nbsp;人：</label><input type="text" name="ship_man" id="recipient_name" onkeyup="this.value=this.value.replace(/\s+/g,'')"><span id="spn_ship_man" class="hint new_tip" style="display: block;">请填写收货人姓名</span></li>
            <li>
                <label><strong>*</strong>收货地区：</label>
                <select id="country_id" name="country_id" style="display: block;" autocomplete="off"><option value="">--请选择--</option><option value="9000" text="中国">中国</option><option value="16767">阿尔及利亚</option><option value="11717">阿根廷</option><option value="16161">阿联酋</option><option value="12020">埃及</option><option value="12525">爱尔兰</option><option value="11919">奥地利</option><option value="10909">澳大利亚</option><option value="14747">巴基斯坦</option><option value="12828">巴拿马</option><option value="10707">巴西</option><option value="16868">白俄罗斯</option><option value="16969">保加利亚</option><option value="13535">比利时</option><option value="15656">波多黎各</option><option value="14949">波兰</option><option value="17272">玻利维亚</option><option value="14444">丹麦</option><option value="10505">德国</option><option value="15353">俄罗斯</option><option value="10404">法国</option><option value="12222">菲律宾</option><option value="12323">芬兰</option><option value="17474">古巴</option><option value="12424">关岛</option><option value="10808">韩国</option><option value="12121">荷兰</option><option value="11010">加拿大</option><option value="15151">柬埔寨</option><option value="11111">捷克</option><option value="17373">喀麦隆</option><option value="14848">科威特</option><option value="15858">老挝</option><option value="16262">黎嫩</option><option value="15959">列支敦士登</option><option value="16060">卢森堡</option><option value="17070">卢旺达</option><option value="13030">罗马尼亚</option><option value="15555">马尔代夫</option><option value="13636">马来西亚</option><option value="10101">美国</option><option value="14545">蒙古</option><option value="17171">孟加拉</option><option value="11818">秘鲁</option><option value="11212">墨西哥</option><option value="13232">南非</option><option value="16666">南斯拉夫</option><option value="16363">尼日利亚</option><option value="11313">挪威</option><option value="12929">葡萄牙</option><option value="10303">日本</option><option value="11414">瑞典</option><option value="13737">瑞士</option><option value="13838">塞浦路斯</option><option value="16464">沙特阿拉伯</option><option value="13333">斯里兰卡</option><option value="13434">泰国</option><option value="13939">坦桑尼亚</option><option value="15757">土耳其</option><option value="15252">委内瑞拉</option><option value="15050">文莱</option><option value="14040">乌克兰</option><option value="16565">乌拉圭</option><option value="11515">西班牙</option><option value="14343">希腊</option><option value="13131">新加坡</option><option value="12727">新西兰</option><option value="14141">匈牙利</option><option value="12626">牙买加</option><option value="11616">意大利</option><option value="10606">印度</option><option value="14646">印度尼西亚</option><option value="10202">英国</option><option value="14242">越南</option><option value="15454">智利</option><option value="19999">其他国家或地区</option></select>
                <select id="province_id" name="province_id" style="display: none;" autocomplete="off"><option value="">--请选择--</option><option value="111" text="北京">北京</option><option value="112">天津</option><option value="113">河北</option><option value="114">山西</option><option value="115">内蒙古</option><option value="121">辽宁</option><option value="122">吉林</option><option value="123">黑龙江</option><option value="131">上海</option><option value="132">江苏</option><option value="133">浙江</option><option value="134">安徽</option><option value="135">福建</option><option value="136">江西</option><option value="137">山东</option><option value="141">河南</option><option value="142">湖北</option><option value="143">湖南</option><option value="144">广东</option><option value="145">广西</option><option value="146">海南</option><option value="150">重庆</option><option value="151">四川</option><option value="152">贵州</option><option value="153">云南</option><option value="154">西藏</option><option value="161">陕西</option><option value="162">甘肃</option><option value="163">青海</option><option value="164">宁夏</option><option value="165">新疆</option><option value="171">台湾</option><option value="172">香港</option><option value="173">澳门</option><option value="33">其他省份</option></select>
                <select id="city_id" name="city_id" style="display: none;" autocomplete="off"><option value="">--请选择--</option><option value="1">东城区</option><option value="2">西城区</option><option value="3" text="朝阳区">朝阳区</option><option value="4">崇文区</option><option value="5" text="海淀区">海淀区</option><option value="6">宣武区</option><option value="7">石景山区</option><option value="8">门头沟区</option><option value="9">丰台区</option><option value="10">房山区</option></select>

            <li><label><strong>*</strong>详细地址：</label><input type="text" name="ship_man" maxlength="40" id="detailed_address" onkeyup="this.value=this.value.replace(/\s+/g,'')"></li>
            <li><label><strong>*</strong>邮政编码：</label><input type="text" name="ship_man"  maxlength="6" id="postcode" onkeyup = "value=value.replace(/[^\d]/g,'')"></li>
            <li><label><strong>*</strong>手&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;机：</label><input type="text" name="ship_man" maxlength="11" id="addr_mobile" onkeyup = "value=value.replace(/[^\d]/g,'')"><label>或&nbsp;&nbsp;固定电话</label><input type="text" name="ship_man"  maxlength="8" id="addr_tel" onkeyup = "value=value.replace(/[^\d]/g,'')"></li>

        </ul>
        <div class="balance"><p>商品金额：¥60.30</p><p class="yfze">应付总额（含运费）：<em>¥60.30</em></p><p><a href="javascript: void 0" id="submit_indent">提交订单</a></p></div>
    </div>
    <div class="shdz">
    	<h3>订单1（百知网配送）</h3>
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tbody id="indent_book_tobdy">
            <tr style="height:30px; line-height:30px;">
                <th width="34%">商品名称</th>
                <th width="11%">所在仓库</th>
                <th width="13%">百知价</th>
                <th width="11%">促销价</th>
                <th width="9%">数量</th>
                <th width="11%">小计</th>
                <th width="11%">操作</th>
            </tr>
            </tbody>
        </table>
    </div>

</div>
</div>


<div id="indent_ok_div" style="display: none;">
    <div class="logo_line">
    <div class="w960">
        <div class="shopping_procedure02 shopping_procedure "><span>我的购物车</span><span>填写订单</span><span class="current">完成订单</span></div>
        <div class="logo"><a href="#"><img src="/static/images/bz_logo_car.jpg" alt=""></a></div>
    </div>
</div>
<div class="checkout-wrap">
<div class="indent_con">
	<div class="order-box orderEnd-box">
            <div class="orderEnd-box-top">
                <div class="topbar">
                </div>
                <h2>
                    <span id="spanOrderTip" class="text">感谢您提交订单，我们将及时为您处理！</span>


                </h2>

            </div>
            <div class="orderEnd-box-cont">
                <div id="NotPeerPayOrderList" class="pay-instead-order">


                </div>
                <div class="pay-normal" id="order_list"> <div class="item-order"><h3>订单：<a href="javascript:void 0"><span class="number">34673930343</span></a></h3><div class="cont minh-40"><table cellpadding="0" cellspacing="0">	 		<tbody><tr><td width="53"></td><td>
                    <span class="popup-Details spd"><span id="indent_books_amount">1</span>件商品<i class="icon icon-details"></i><div class="popup-wrap popup-orderEnd-detail" style="right:-288px; top:12px;display:none;"><div class="popup-cont">		 			<p><span class="span-w230">活着（余华经典著作）</span><strong class="color-orange">x1</strong></p>				</div></div></span>			    	        <div class="popup-wrap popup-orderEnd-detail" style="right:-288px; top:12px;display:none;"><div class="popup-cont">			 				<p><span class="span-w230">活着（余华经典著作）</span><strong class="color-orange">x1</strong></p>			</div></div><span>送给</span>
                    <span class="popup-Details spd" id="indent_recipient_name">郭雅雪<i class="icon icon-details"></i><div class="popup-wrap popup-orderEnd-detail" style="right:-288px; top:12px;display:none;"><div class="popup-cont"><p>中国 北京 北京市 海淀区 西二旗铭科苑小区十一号楼二单元601 100019</p><p>电话：15901551248</p></div></div></span><span>配送方为</span><span>当当网</span>   		</td></tr>							<tr class="hackie6"><td>&nbsp;</td></tr>					</tbody></table></div>					<div class="order-price"><p>支付金额：<span class="price-d">¥15.00</span>        </p><p class="p-hdfk">货到付款</p></div>					<div class="itemtext"><span class="color-red">安全提醒：</span>当当平台及销售商不会以订单异常、系统升级等理由，通过任何方式发送给您退款链接。请您谨防<span class="color-red">钓鱼链接或诈骗电话</span>！</div></div></div>

                <div class="item-order item-order-payment" id="error_prompt" style="display:none;"> <!-- 需要隐藏，添加hide类即可 -->
                    <div class="tips-pay">
                        <strong>温馨提示：</strong>
                        <span>如果您有网上支付、银行转账的订单，请您在<strong class="color-red">24</strong>小时内支付 <a href="http://order.dangdang.com/myallorders" id="a_myorder">查看订单</a> </span><br>
                        <span style="padding-left:67px;">您还有 <strong class="color-red">1</strong> 张"待提交"订单 <a href="http://shopping.dangdang.com/shoppingcart/dispart_order.aspx" id="a_submitorder">继续提交</a></span>
                    </div>
                </div>
            </div>
        </div>


</div></div>

</div>



<div id="footer">
<div class="footer">
	<div class="footer_nav_box">
		<div class="footer_copyright"><span>Copyright (C) 当当网 2004-2014, All Rights Reserved</span><a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001051000098" target="_blank" class="footer_img" rel="nofollow"><img src="http://img4.dangdang.com/bottom/validate.gif"></a><span><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP证041189号</a></span><span>出版物经营许可证&nbsp;新出发京批字第直0673号</span></div>
	</div>
</div>
</div>
    <div class="foot_tip_ad">广告</div>
    <style>
        .foot_tip_ad { width:40px; height:40px; font:12px/40px "simsun"; text-align:center; color:#fff; background-color:#474747; position:fixed; right:0; bottom:10px;_position:absolute; _bottom:auto;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)));}
    </style>


<script type="text/javascript" src="/static/jq/jquery.js"></script>
<script type="text/javascript">
    var csrftoken = "{{ csrf_token }}";
    function total_price_function() {
        var a_tips = $("a[name='check_on_tap_a']");
        var a_price_arr = []
        var a_price_save_arr= []
        var a_amount_arr = []
        for (var i = 0; i<a_tips.length;i++){
            if (a_tips[i].classList.contains("check_on")){
                a_price_arr.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.textContent)
                a_amount_arr.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.firstElementChild.nextElementSibling.value)
                console.log(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.textContent)
                console.log(a_tips[i].nextElementSibling.textContent)
                a_price_save_arr.push(a_tips[i].nextElementSibling.textContent)
                console.log(a_amount_arr)
            }
        }
        var price_final = 0
        var price_save = 0
        var books_amount = 0
        for (var j = 0; j<a_price_arr.length;j++){
            price_final += parseFloat(a_price_arr[j].substring(1,a_price_arr[j].length))
            price_save += parseFloat(a_price_save_arr[j])*parseFloat(a_amount_arr[j])
            books_amount += parseInt(a_amount_arr[j])
{#            console.log(price_final + parseFloat(a_price_arr[j].substring(1,a_price_arr[j].length)))#}
        }
        $("#total_price").text("¥"+price_final.toFixed(2))
        $("#payAmount").text("¥"+price_final.toFixed(2))
        $("#totalFavor").text("¥"+(price_save-price_final).toFixed(2))
        $("#books_amount").text(books_amount)
    }
{#    total_price_function()#}
    var add_amount = function (dom) {
        var amount = parseInt(dom.previousElementSibling.value);
        var book_id = dom.parentNode.parentNode.parentNode.parentNode.id;
        dom.previousElementSibling.value = amount + 1;
        amount++;
        var price_span = dom.parentNode.parentNode.previousElementSibling.firstElementChild;
        var price = price_span.id;
        var change_span = dom.parentNode.parentNode.nextElementSibling.firstElementChild;
        change_span.innerHTML = "¥"+(price*amount).toFixed(2);
        $("#load_gif").css("display","inline-block");
        var csrftoken = "{{ csrf_token }}";
        $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
        $.ajax({
            type:"post",//请求方式get/post
            url:"{% url 'shopping_cart:change_amount' %}",//请求地址
            data:{book_id:book_id,amount:amount},//请求参数
            dataType:"json",
            success:function(abc){//abc==xhr.responseText或解析后的js对象
                console.log("OK")
                $("#total_price").text("¥"+abc.total)
                $("#load_gif").css("display","none");
                total_price_function()
            }
        });
    }
    var reduce_amount = function (dom) {
        var amount = parseInt(dom.nextElementSibling.value);
        var book_id = dom.parentNode.parentNode.parentNode.parentNode.id;
        dom.nextElementSibling.value = amount - 1;
        amount--;
        if (amount<1){
            dom.nextElementSibling.value = 1;
            amount = 1
        }
        var price_span = dom.parentNode.parentNode.previousElementSibling.firstElementChild;
        var price = price_span.id;
        var change_span = dom.parentNode.parentNode.nextElementSibling.firstElementChild;
        change_span.innerHTML = "¥"+(price*amount).toFixed(2);
        $("#load_gif").css("display","inline-block");
        var csrftoken = "{{ csrf_token }}";
        $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
        $.ajax({
            type:"post",//请求方式get/post
            url:"{% url 'shopping_cart:change_amount' %}",//请求地址
            data:{book_id:book_id,amount:amount},//请求参数
            dataType:"json",
            success:function(abc){//abc==xhr.responseText或解析后的js对象
                console.log("OK")
                $("#total_price").text("¥"+abc.total)
                $("#load_gif").css("display","none");
                total_price_function()
            }
        });
    }
    var amount_input_blur = function (dom) {
        var book_id = dom.parentNode.parentNode.parentNode.parentNode.id;
        var amount = parseInt(dom.value);
        console.log(amount);
        console.log(book_id);
        var price_span = dom.parentNode.parentNode.previousElementSibling.firstElementChild;
        var price = price_span.id;
        var change_span = dom.parentNode.parentNode.nextElementSibling.firstElementChild;
        change_span.innerHTML = "¥"+(price*amount).toFixed(2);
        $("#load_gif").css("display","inline-block");
        var csrftoken = "{{ csrf_token }}";
        $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
        $.ajax({
            type:"post",//请求方式get/post
            url:"{% url 'shopping_cart:change_amount' %}",//请求地址
            data:{book_id:book_id,amount:amount},//请求参数
            dataType:"json",
            success:function(abc){//abc==xhr.responseText或解析后的js对象
                console.log("OK")
                $("#total_price").text("¥"+abc.total)
                $("#load_gif").css("display","none");
                total_price_function()
            }
        });

    };

    var check_on_off = function (dom) {
        console.log(dom.classList.contains("check_on"));
        var total_price = parseFloat($("#total_price").text().substring(1,$("#total_price").text().length-1)).toFixed(2)
        var price_span = dom.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild
        var price_str = $(price_span).text()
        var price = parseFloat(price_str.substring(1,price_str.length - 1)).toFixed(2)
        if (dom.classList.contains("check_on")){
            dom.classList.remove("check_on");
            $("#j_selectall").attr("class", "checknow fn-checkall");
            $("#check_shop").attr("class", "checknow fn-checkall");
            var final_price1 = (total_price-price).toFixed(2)
            console.log(final_price1)
            total_price_function()
        }else {
            dom.classList.add("check_on");
            var final_price2 = (parseFloat(total_price)+parseFloat(price)).toFixed(2);
            console.log(final_price2);
            total_price_function()
        }
    };

    $("#j_selectall").click(function () {
        var a_list = $("a[name='check_on_tap_a']");
        console.log(a_list.length);
        if (this.classList.contains("check_on")) {
            this.classList.remove("check_on");
            $("#check_shop").attr("class", "checknow fn-shop-checkall");
            $("#j_selectall").attr("class", "checknow fn-checkall");
            for (var i = 0; i < a_list.length; i++) {
                a_list.eq(i).attr("class", "fn-product-check checknow");
            }
            total_price_function()
        } else {
            this.classList.add("check_on");
            $("#check_shop").attr("class", "checknow fn-shop-checkall check_on");
            $("#j_selectall").attr("class", "checknow fn-checkall check_on");
            for (var j = 0; j < a_list.length; j++) {
                a_list.eq(j).attr("class", "fn-product-check checknow check_on");
            }
            total_price_function()

        }
    });

    $("#check_shop").click(function () {
        var a_list2 = $("a[name='check_on_tap_a']");
        console.log(a_list2.length);
        if (this.classList.contains("check_on")){
            this.classList.remove("check_on");
            for(var i=0;i<a_list2.length;i++){
                a_list2.eq(i).attr("class","fn-product-check checknow");
            }
            $("#j_selectall").attr("class", "checknow fn-checkall");
            $("#check_shop").attr("class", "checknow fn-checkall");
            total_price_function()
        }else{
            this.classList.add("check_on");
            for(var j=0;j<a_list2.length;j++){
                a_list2.eq(j).attr("class","fn-product-check checknow check_on");
            }
            total_price_function()
        }
    })

    var check_on_off_key_up = function(dom){
        var c=$(dom);
        var value = c.val();
        console.log("dom",c);
        console.log("value",value)
        if(/[^\d]/.test(c.val())){
            var temp=c.val().replace(/[^\d]/g,'');
            $(dom).val(temp);
        }else {
            $(dom).val(value)
        }
        if ($(dom).val()<1){
            $(dom).val(1)
        }
    }

    var del_book = function (dom) {
       var book_id_node = dom.parentNode.parentNode.parentNode.parentNode
       var book_id = book_id_node.id;
       console.log(book_id);
       $("#load_gif").css("display","inline-block");
       var csrftoken = "{{ csrf_token }}";
       $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
       $.ajax({
           type:"post",//请求方式get/post
           url:"{% url 'shopping_cart:del_book' %}",//请求地址
           data:{book_id:book_id},//请求参数
           dataType:"json",
           success:function(abc){//abc==xhr.responseText或解析后的js对象
               console.log("OK");
               $("#total_price").text("¥"+abc.total);
               $("#load_gif").css("display","none");
               $("#payAmount").text("¥"+abc.total);
               $("#totalFavor").text("¥"+abc.save);
               $(book_id_node).remove();
           }
       });
    };

    $("#j_removeproducts").click(function () {
        var a_tap_list = $("a[name='check_on_tap_a']");
        var tbodys = [];
        var id_str = ""
        for (var i = 0; i< a_tap_list.length; i++){
            if (a_tap_list[i].classList.contains("check_on")){
                console.log(a_tap_list[i].parentNode.parentNode.parentNode);
                var ele_a = a_tap_list[i].parentNode.parentNode.parentNode
                tbodys.push(ele_a);
                console.log($(tbodys[i]).attr("id"));
                id_str += ele_a.id + ","
            }
        }
        console.log(tbodys);
        console.log(id_str.substring(0, id_str.length-1));
        id_str = id_str.substring(0, id_str.length-1);
        var csrftoken = "{{ csrf_token }}";
        $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
        $.ajax({
            type:"post",//请求方式get/post
            url:"{% url 'shopping_cart:del_book' %}",//请求地址
            data:{book_id:id_str},//请求参数
            dataType:"json",
            success:function(abc){//abc==xhr.responseText或解析后的js对象
                console.log("OK");
                $("#total_price").text("¥"+abc.total);
                $("#load_gif").css("display","none");
                $("#payAmount").text("¥"+abc.total);
                $("#totalFavor").text("¥"+abc.save);
                for (var i = 0;i< tbodys.length;i++){
                    $(tbodys[i]).remove()
                }
            }
        });

    })

        remove_check_on_arr = [];
        put_back_to_shopping_cart = function (dom) {
            remove_check_on_arr.push(parseInt($(dom).attr("id")-1));
            $(dom.parentNode.parentNode).remove();
            var price_td_arr = $(".my_td_price");
            var ele_td_price = []
            var the_latest_price = 0;
            for (var i = 0; i<price_td_arr.length; i++){
                ele_td_price.push(parseFloat(price_td_arr[i].textContent.substring(1,price_td_arr[i].textContent.length-1)).toFixed(2));
            }
            for(var j = 0;j<ele_td_price.length;j++){
                the_latest_price += parseFloat(ele_td_price[j])
            }
            $(".balance p").eq(0).text(the_latest_price.toFixed(2))
            $(".yfze em").eq(0).text(the_latest_price.toFixed(2))
            $(".table_zj em").eq(0).text(the_latest_price.toFixed(2))
            console.log(remove_check_on_arr)
        };

{#结算时，将选中的图书数据存到一个数组中#}
    function confirm_indent() {
        var a_tips = $("td.row1").find(".check_on");
        a_price_arr = [];
        a_amount_arr = [];
        per_book_price = [];
        per_book_name = [];
        for (var i = 0; i<a_tips.length;i++){
            a_price_arr.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.textContent)
            a_amount_arr.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.firstElementChild.nextElementSibling.value)
            per_book_name.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.firstElementChild.firstElementChild.textContent)
            per_book_price.push(a_tips[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.textContent);

        }
        console.log(a_price_arr);
        console.log(a_amount_arr);
        console.log(per_book_price);
        console.log(per_book_name);
        for (var j = 0; j<a_price_arr.length;j++){
            $("#indent_book_tobdy").append("<tr align='center'><td></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center' class='indent_books_amount'></td><td align='center' class='my_td_price'></td><td align='center'><a href='javascript: void 0;' onclick='put_back_to_shopping_cart(this)'></a></td></tr>")
        }
    }


    function pay_button_click() {
        confirm_indent()
        var num = a_price_arr.length+1;
        for (var k = 1; k < num; k++) {
            $("#indent_book_tobdy tr").eq(k).children().eq(0).text(per_book_name[k-1]);
            $("#indent_book_tobdy tr").eq(k).children().eq(1).text("python133");
            $("#indent_book_tobdy tr").eq(k).children().eq(2).text(per_book_price[k-1]);
            $("#indent_book_tobdy tr").eq(k).children().eq(3).text("--");
            $("#indent_book_tobdy tr").eq(k).children().eq(4).text(a_amount_arr[k-1]);
            $("#indent_book_tobdy tr").eq(k).children().eq(5).text(a_price_arr[k-1]);
            $("#indent_book_tobdy tr").eq(k).children().eq(6).children().eq(0).text("放回购物车");
            $("#indent_book_tobdy tr").eq(k).children().eq(6).children().eq(0).attr("id",k)
        }
        $("#indent_book_tobdy").append("<tr><td colspan='2'><input type='checkbox' >"+"此订单作为礼品赠送他人"+"</td><td colspan='2'><strong>"+"运费："+"</strong>"+"当确认送货方式后显示"+"</td><td class='table_zj' colspan='3'><strong>"+"小计总额："+"</strong><em>¥368.40</em></td></tr>")
        $("#indent_book_tobdy tr").eq($("#indent_book_tobdy tr").length-1).children().eq(2).children().eq(1).text($("#payAmount").text())
        $(".balance p").eq(0).text($("#payAmount").text())
        $(".yfze em").eq(0).text($("#payAmount").text())
    }



    $("#checkout_btn").click(function () {
        var user_name = "{{ user_name }}";
        var csrftoken = "{{ csrf_token }}";
        $("#confirm_login_state").css("display","inline-block");
        $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
        $.ajax({
            type:"post",//请求方式get/post
            url:"{% url 'shopping_cart:confirm_login_state' %}",//请求地址
            data:{user_name: user_name},
            dataType:"json",
            success:function(abc){
                var msg = abc;
                console.log(abc.user_name);
                if (abc.user_name == ""){
                    location.href = "{% url 'customer:login' %}?shopping_cart=1";
                }else {
                    $("#confirm_login_state").css("display","none");
                    $("#shopping_cart_div").css("display","none");
                    $("#indent_div").css("display","block");
                    pay_button_click();
                    for (var per_address = 0;per_address<abc.addr_id.length;per_address++){
                        $("#user_address").append("<option value="+abc.addr_id[per_address]+">"+abc.recipient_list[per_address]+"</option>")
                    }
                }
            }
        })

    })

    $("#country_id").change(function () {
        if ($(this).val() != 0){
            $("#province_id").fadeIn("slow")

        }else {
            $("#province_id").fadeOut("slow")
            $("#city_id").fadeOut("slow")
        }
    });
    $("#province_id").change(function () {
        if ($(this).val()!=0){
            $("#city_id").fadeIn("slow")
        }else {
            $("#city_id").fadeOut("slow")
        }
    });

    function clear_option_selected(dom) {
        var option_arr = dom.children();
        console.log(option_arr);
        for (var i=0;i<option_arr.length;i++){
           option_arr.eq(i).removeAttr("selected")
        }
    }

    $("#user_address").change(function () {
        console.log($("#user_address option:selected").val());
        var select_val = $("#user_address option:selected").val();
        if (select_val != 0){
            $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
            $.ajax({
                type:"post",//请求方式get/post
                url:"{% url 'shopping_cart:address_query' %}",//请求地址
                data:{address_id: select_val},
                dataType:"json",
                success:function(abc){
                    clear_option_selected($("#country_id"));
                    clear_option_selected($("#province_id"));
                    clear_option_selected($("#city_id"));
                    $("#country_id").removeAttr("disabled");
                    $("#province_id").removeAttr("disabled");
                    $("#city_id").removeAttr("disabled");
                    var addr = abc.recipient_address;
                    $("#recipient_name").val(abc.recipient_name);
                    $("#recipient_name").attr("readonly","readonly");
                    console.log(addr);


                    $("#country_id").find("option[text="+addr[0]+"]").prop("selected", "selected");

                    $("#province_id").find("option[text="+addr[1]+"]").prop("selected", "selected");

                    $("#city_id").find("option[text="+addr[2]+"]").prop("selected", "selected");


                    $("#country_id").css("display", "block");
                    $("#province_id").css("display", "block");
                    $("#city_id").css("display", "block");

                    $("#detailed_address").val(addr[3]);
                    $("#detailed_address").attr("readonly","readonly");
                    $("#postcode").val(abc.postcode);
                    $("#postcode").attr("readonly","readonly");
                    $("#addr_mobile").val(abc.addr_mobil);
                    $("#addr_mobile").attr("readonly","readonly");
                    $("#addr_tel").val(abc.addr_tel);
                    $("#addr_tel").attr("readonly","readonly");

                    $("#country_id").attr("disabled", "disabled");
                    $("#province_id").attr("disabled", "disabled");
                    $("#city_id").attr("disabled", "disabled");
                }
            })
        }else {
            $("#country_id").removeAttr("disabled");
            $("#province_id").removeAttr("disabled");
            $("#city_id").removeAttr("disabled");
            clear_option_selected($("#country_id"));
            clear_option_selected($("#province_id"));
            clear_option_selected($("#city_id"));
            $("#recipient_name").val("");
            $("#recipient_name").removeAttr("readonly");
            $("#country_id").css("display", "block");

            $("#province_id").css("display", "none");

            $("#city_id").css("display", "none");
            $("#detailed_address").val("");
            $("#detailed_address").removeAttr("readonly");
            $("#postcode").val("");
            $("#postcode").removeAttr("readonly");
            $("#addr_mobile").val("");
            $("#addr_mobile").removeAttr("readonly");
            $("#addr_tel").val("");
            $("#addr_tel").removeAttr("readonly");
        }
    });

    $("#submit_indent").click(function () {
        var recipient_name = $("#recipient_name").val();
        var detailed_address = $("#detailed_address").val();
        var postcode = $("#postcode").val();
        var addr_mobile = $("#addr_mobile").val();
        var addr_tel = $("#addr_tel").val();
        var country = $("#country_id option:selected").text();
        var province = $("#province_id option:selected").text();
        var city = $("#city_id option:selected").text();
        remove_check_on_arr
        var books_check_on = $("td.row1").find(".check_on");

        var total_price = parseFloat($("div.balance p").eq(0).text().substring(1,$("div.balance p").eq(0).text().length)).toFixed(2)

        for (var i = 0;i<remove_check_on_arr.length;i++){
            books_check_on.eq(parseInt(remove_check_on_arr[i])).attr("class","fn-product-check checknow")
        }
        var buy_books_list = $("td.row1").find(".check_on");
        var buy_books_id_list = [];
        var buy_books_amount_list = [];
        var buy_books_price_list = [];
        var buy_books_price_td = $("td.my_td_price");
        var buy_books_amount_td = $("td.indent_books_amount");
        var user_name = "{{ user_name }}"
        for (var ele_book = 0;ele_book<buy_books_list.length;ele_book++){
            buy_books_id_list.push(parseInt(buy_books_list[ele_book].parentNode.parentNode.parentNode.id));
            buy_books_amount_list.push(parseInt(buy_books_amount_td.eq(ele_book).text()))
            buy_books_price_list.push(parseFloat(buy_books_price_td.eq(ele_book).text().substring(1,buy_books_price_td.eq(ele_book).text().length)).toFixed(2))
        }
        console.log(buy_books_id_list)
        console.log(buy_books_amount_list)
        console.log(buy_books_price_list)
        var user_address_id = "";
        if ($("#user_address").val()){
            user_address_id = $("#user_address").val()
        }
        if (recipient_name == ""){
            alert("请填写收货人")
        }else if (detailed_address == ""){
            alert("请填写详细地址")
        }else if (postcode == ""){
            alert("请填写邮编")
        }else if (addr_mobile == "" && addr_tel == ""){
            alert("收件人手机或者固定电话至少填写一个")
        }else if (country=="--请选择--" || province=="--请选择--" || city =="--请选择--"){
            alert("请选择收货地区")
        }else{
            $.ajaxSetup({headers:{"X-CSRFToken":csrftoken}});
            $.ajax({
                type:"post",//请求方式get/post
                url:"{% url 'shopping_cart:address_save' %}",//请求地址
                data:{total_price:total_price,user_address_id:user_address_id,buy_books_price_list:buy_books_price_list,buy_books_amount_list:buy_books_amount_list,buy_books_id_list:buy_books_id_list,user_name: user_name,recipient_name:recipient_name,detailed_address:detailed_address,postcode:postcode,addr_mobile:addr_mobile,addr_tel:addr_tel,country:country,province:province,city:city},
                traditional:true,
                dataType:"json",
                success:function(abc){
                    var msg = abc;
                    console.log(abc.OK);
                    $("#indent_div").css("display","none");
                    $("#indent_ok_div").css("display","block")
                    $("span.number").text(abc.indent_num)
                    $("#indent_books_amount").text(abc.books_amount)
                    $("#indent_recipient_name").text(abc.recipient_name)

                }
            })
        }
    })    
    
</script>

</body>
</html>
